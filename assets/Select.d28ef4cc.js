import{q as je,p as oe,cY as Ne,d as ze,H as Le,I as de,eh as Ke,r as s,x as N,D as m,K as We,Q as z,a0 as re,V as $e,ds as Ee,m as O,a8 as qe,c7 as He,cq as Qe,dl as ue,a1 as h}from"./index.78c09cee.js";import{t as Ye,c as Ge,f as Je,a as Xe,b as Ze,d as et}from"./utils.660e96e0.js";import{u as se}from"./use-merged-state.c2667ee5.js";import{e as tt}from"./Tag.9b989cfb.js";import{u as nt}from"./use-locale.c29a83eb.js";import{u as lt}from"./use-compitable.3d828e2e.js";import{h as at}from"./happens-in.f44eb706.js";import{u as L,V as it,a as ot,b as rt}from"./Follower.d919f920.js";var ut=je([oe("select",`
 z-index: auto;
 outline: none;
 width: 100%;
 position: relative;
 `),oe("select-menu",`
 margin: 4px 0;
 box-shadow: var(--n-menu-box-shadow);
 `,[Ne()])]);const st=Object.assign(Object.assign({},de.props),{to:L.propTo,bordered:{type:Boolean,default:void 0},clearable:Boolean,clearFilterAfterSelect:{type:Boolean,default:!0},options:{type:Array,default:()=>[]},defaultValue:{type:[String,Number,Array],default:null},value:[String,Number,Array],placeholder:String,menuProps:Object,multiple:Boolean,size:String,filterable:Boolean,disabled:{type:Boolean,default:void 0},remote:Boolean,loading:Boolean,filter:{type:Function,default:et},placement:{type:String,default:"bottom-start"},widthMode:{type:String,default:"trigger"},tag:Boolean,onCreate:{type:Function,default:n=>({label:n,value:n})},fallbackOption:{type:[Function,Boolean],default:()=>n=>({label:String(n),value:n})},show:{type:Boolean,default:void 0},showArrow:{type:Boolean,default:!0},maxTagCount:[Number,String],consistentMenuWidth:{type:Boolean,default:!0},virtualScroll:{type:Boolean,default:!0},renderLabel:Function,renderOption:Function,renderTag:Function,"onUpdate:value":[Function,Array],inputProps:Object,onUpdateValue:[Function,Array],onBlur:[Function,Array],onClear:[Function,Array],onFocus:[Function,Array],onScroll:[Function,Array],onSearch:[Function,Array],onUpdateShow:[Function,Array],"onUpdate:show":[Function,Array],displayDirective:{type:String,default:"show"},resetMenuOnOptionsChange:{type:Boolean,default:!0},status:String,onChange:[Function,Array],items:Array});var bt=ze({name:"Select",props:st,setup(n){const{mergedClsPrefixRef:d,mergedBorderedRef:M,namespaceRef:b,inlineThemeDisabled:u}=Le(n),K=de("Select","-select",ut,Ke,n,d),D=s(n.defaultValue),ce=N(n,"value"),S=se(ce,D),T=s(!1),w=s(""),fe=m(()=>tt(H.value,Ye)),W=m(()=>Ge(q.value)),F=s(!1),c=se(N(n,"show"),F),f=s(null),$=s(null),C=s(null),{localeRef:he}=nt("Select"),ve=m(()=>{var e;return(e=n.placeholder)!==null&&e!==void 0?e:he.value.placeholder}),k=lt(n,["items","options"]),g=s([]),p=s([]),R=s(new Map),E=m(()=>{const{fallbackOption:e}=n;return e?t=>Object.assign(e(t),{value:t}):!1}),q=m(()=>p.value.concat(g.value).concat(k.value)),H=m(()=>{if(n.remote)return k.value;{const{value:e}=q,{value:t}=w;if(!t.length||!n.filterable)return e;{const{filter:l}=n;return Je(e,l,t)}}});function U(e){const t=n.remote,{value:l}=R,{value:i}=W,{value:a}=E,o=[];return e.forEach(r=>{if(i.has(r))o.push(i.get(r));else if(t&&l.has(r))o.push(l.get(r));else if(a){const I=a(r);I&&o.push(I)}}),o}const Q=m(()=>{if(n.multiple){const{value:e}=S;return Array.isArray(e)?U(e):[]}return null}),Y=m(()=>{const{value:e}=S;return!n.multiple&&!Array.isArray(e)?e===null?null:U([e])[0]||null:null}),B=We(n),{mergedSizeRef:me,mergedDisabledRef:A,mergedStatusRef:ge}=B;function V(e,t){const{onChange:l,"onUpdate:value":i,onUpdateValue:a}=n,{nTriggerFormChange:o,nTriggerFormInput:r}=B;l&&h(l,e,t),a&&h(a,e,t),i&&h(i,e,t),D.value=e,o(),r()}function G(e){const{onBlur:t}=n,{nTriggerFormBlur:l}=B;t&&h(t,e),l()}function pe(){const{onClear:e}=n;e&&h(e)}function be(e){const{onFocus:t}=n,{nTriggerFormFocus:l}=B;t&&h(t,e),l()}function Oe(e){const{onSearch:t}=n;t&&h(t,e)}function Se(e){const{onScroll:t}=n;t&&h(t,e)}function J(){var e;const{remote:t,multiple:l}=n;if(t){const{value:i}=R;if(l)(e=Q.value)===null||e===void 0||e.forEach(a=>{i.set(a.value,a)});else{const a=Y.value;a&&i.set(a.value,a)}}}function X(e){const{onUpdateShow:t,"onUpdate:show":l}=n;t&&h(t,e),l&&h(l,e),F.value=e}function P(){A.value||(X(!0),F.value=!0,n.filterable&&De())}function v(){X(!1)}function Z(){w.value="",p.value=[]}const x=s(!1);function we(){n.filterable&&(x.value=!0)}function ye(){n.filterable&&(x.value=!1,c.value||Z())}function Me(){A.value||(c.value?n.filterable||v():P())}function Te(e){var t,l;!((l=(t=C.value)===null||t===void 0?void 0:t.selfRef)===null||l===void 0)&&l.contains(e.relatedTarget)||(T.value=!1,G(e),v())}function Ce(e){be(e),T.value=!0}function Fe(e){T.value=!0}function Re(e){var t;!((t=f.value)===null||t===void 0)&&t.$el.contains(e.relatedTarget)||(T.value=!1,G(e),v())}function Be(){var e;(e=f.value)===null||e===void 0||e.focus(),v()}function Ae(e){var t;c.value&&(!((t=f.value)===null||t===void 0)&&t.$el.contains(e.target)||v())}function Ve(e){if(!Array.isArray(e))return[];if(E.value)return Array.from(e);{const{remote:t}=n,{value:l}=W;if(t){const{value:i}=R;return e.filter(a=>l.has(a)||i.has(a))}else return e.filter(i=>l.has(i))}}function ee(e){_(e.rawNode)}function _(e){if(A.value)return;const{tag:t,remote:l,clearFilterAfterSelect:i}=n;if(t&&!l){const{value:a}=p,o=a[0]||null;o&&(g.value.push(o),p.value=[])}if(l&&R.value.set(e.value,e),n.multiple){const a=Ve(S.value),o=a.findIndex(r=>r===e.value);if(~o){if(a.splice(o,1),t&&!l){const r=te(e.value);~r&&(g.value.splice(r,1),i&&(w.value=""))}}else a.push(e.value),i&&(w.value="");V(a,U(a))}else{if(t&&!l){const a=te(e.value);~a?g.value=[g.value[a]]:g.value=[]}le(),v(),V(e.value,e)}}function te(e){return g.value.findIndex(l=>l.value===e)}function Pe(e){c.value||P();const{value:t}=e.target;w.value=t;const{tag:l,remote:i}=n;if(Oe(t),l&&!i){if(!t){p.value=[];return}const a=n.onCreate(t);k.value.some(o=>o.value===a.value)||g.value.some(o=>o.value===a.value)?p.value=[]:p.value=[a]}}function xe(e){e.stopPropagation();const{multiple:t}=n;!t&&n.filterable&&v(),pe(),t?V([],[]):V(null,null)}function _e(e){at(e,"action")||e.preventDefault()}function Ie(e){Se(e)}function ne(e){var t,l,i,a,o;switch(e.code){case"Space":if(n.filterable)break;e.preventDefault();case"Enter":case"NumpadEnter":if(!(!((t=f.value)===null||t===void 0)&&t.isCompositing)){if(c.value){const r=(l=C.value)===null||l===void 0?void 0:l.getPendingTmNode();r?ee(r):n.filterable||(v(),le())}else if(P(),n.tag&&x.value){const r=p.value[0];if(r){const I=r.value,{value:ie}=S;n.multiple&&Array.isArray(ie)&&ie.some(Ue=>Ue===I)||_(r)}}}e.preventDefault();break;case"ArrowUp":if(e.preventDefault(),n.loading)return;c.value&&((i=C.value)===null||i===void 0||i.prev());break;case"ArrowDown":if(e.preventDefault(),n.loading)return;c.value?(a=C.value)===null||a===void 0||a.next():P();break;case"Escape":v(),(o=f.value)===null||o===void 0||o.focus();break}}function le(){var e;(e=f.value)===null||e===void 0||e.focus()}function De(){var e;(e=f.value)===null||e===void 0||e.focusInput()}function j(){var e;(e=$.value)===null||e===void 0||e.syncPosition()}J(),z(N(n,"options"),J),z(H,()=>{!c.value||re(j)}),z(S,()=>{!c.value||re(j)});const ke={focus:()=>{var e;(e=f.value)===null||e===void 0||e.focus()},blur:()=>{var e;(e=f.value)===null||e===void 0||e.blur()}},ae=m(()=>{const{self:{menuBoxShadow:e}}=K.value;return{"--n-menu-box-shadow":e}}),y=u?$e("select",void 0,ae,n):void 0;return Object.assign(Object.assign({},ke),{mergedStatus:ge,mergedClsPrefix:d,mergedBordered:M,namespace:b,treeMate:fe,isMounted:Ee(),triggerRef:f,menuRef:C,pattern:w,uncontrolledShow:F,mergedShow:c,adjustedTo:L(n),uncontrolledValue:D,mergedValue:S,followerRef:$,localizedPlaceholder:ve,selectedOption:Y,selectedOptions:Q,mergedSize:me,mergedDisabled:A,focused:T,activeWithoutMenuOpen:x,inlineThemeDisabled:u,onTriggerInputFocus:we,onTriggerInputBlur:ye,handleMenuFocus:Fe,handleMenuBlur:Re,handleMenuTabOut:Be,handleTriggerClick:Me,handleToggle:ee,handleDeleteOption:_,handlePatternInput:Pe,handleClear:xe,handleTriggerBlur:Te,handleTriggerFocus:Ce,handleKeydown:ne,syncPosition:j,handleMenuAfterLeave:Z,handleMenuClickOutside:Ae,handleMenuScroll:Ie,handleMenuKeydown:ne,handleMenuMousedown:_e,mergedTheme:K,cssVars:u?void 0:ae,themeClass:y==null?void 0:y.themeClass,onRender:y==null?void 0:y.onRender})},render(){return O("div",{class:`${this.mergedClsPrefix}-select`},O(it,null,{default:()=>[O(ot,null,{default:()=>O(Xe,{ref:"triggerRef",inlineThemeDisabled:this.inlineThemeDisabled,status:this.mergedStatus,inputProps:this.inputProps,clsPrefix:this.mergedClsPrefix,showArrow:this.showArrow,maxTagCount:this.maxTagCount,bordered:this.mergedBordered,active:this.activeWithoutMenuOpen||this.mergedShow,pattern:this.pattern,placeholder:this.localizedPlaceholder,selectedOption:this.selectedOption,selectedOptions:this.selectedOptions,multiple:this.multiple,renderTag:this.renderTag,renderLabel:this.renderLabel,filterable:this.filterable,clearable:this.clearable,disabled:this.mergedDisabled,size:this.mergedSize,theme:this.mergedTheme.peers.InternalSelection,themeOverrides:this.mergedTheme.peerOverrides.InternalSelection,loading:this.loading,focused:this.focused,onClick:this.handleTriggerClick,onDeleteOption:this.handleDeleteOption,onPatternInput:this.handlePatternInput,onClear:this.handleClear,onBlur:this.handleTriggerBlur,onFocus:this.handleTriggerFocus,onKeydown:this.handleKeydown,onPatternBlur:this.onTriggerInputBlur,onPatternFocus:this.onTriggerInputFocus},{arrow:()=>{var n,d;return[(d=(n=this.$slots).arrow)===null||d===void 0?void 0:d.call(n)]}})}),O(rt,{ref:"followerRef",show:this.mergedShow,to:this.adjustedTo,teleportDisabled:this.adjustedTo===L.tdkey,containerClass:this.namespace,width:this.consistentMenuWidth?"target":void 0,minWidth:"target",placement:this.placement},{default:()=>O(qe,{name:"fade-in-scale-up-transition",appear:this.isMounted,onAfterLeave:this.handleMenuAfterLeave},{default:()=>{var n,d,M;return this.mergedShow||this.displayDirective==="show"?((n=this.onRender)===null||n===void 0||n.call(this),He(O(Ze,Object.assign({},this.menuProps,{ref:"menuRef",inlineThemeDisabled:this.inlineThemeDisabled,virtualScroll:this.consistentMenuWidth&&this.virtualScroll,class:[`${this.mergedClsPrefix}-select-menu`,this.themeClass,(d=this.menuProps)===null||d===void 0?void 0:d.class],clsPrefix:this.mergedClsPrefix,focusable:!0,autoPending:!0,theme:this.mergedTheme.peers.InternalSelectMenu,themeOverrides:this.mergedTheme.peerOverrides.InternalSelectMenu,treeMate:this.treeMate,multiple:this.multiple,size:"medium",renderOption:this.renderOption,renderLabel:this.renderLabel,value:this.mergedValue,style:[(M=this.menuProps)===null||M===void 0?void 0:M.style,this.cssVars],onToggle:this.handleToggle,onScroll:this.handleMenuScroll,onFocus:this.handleMenuFocus,onBlur:this.handleMenuBlur,onKeydown:this.handleMenuKeydown,onTabOut:this.handleMenuTabOut,onMousedown:this.handleMenuMousedown,show:this.mergedShow,resetMenuOnOptionsChange:this.resetMenuOnOptionsChange}),{empty:()=>{var b,u;return[(u=(b=this.$slots).empty)===null||u===void 0?void 0:u.call(b)]},action:()=>{var b,u;return[(u=(b=this.$slots).action)===null||u===void 0?void 0:u.call(b)]}}),this.displayDirective==="show"?[[Qe,this.mergedShow],[ue,this.handleMenuClickOutside]]:[[ue,this.handleMenuClickOutside]])):null}})})]}))}});export{bt as N};
